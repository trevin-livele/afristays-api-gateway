# Afristays API Gateway Logging

This directory contains all log files generated by the Afristays API Gateway.

## Log Files

### Main Application Logs
- **afristays-gateway.log** - Main application log with all general application events
- **afristays-gateway-YYYY-MM-DD.*.log** - Archived daily log files

### Request/Response Logs
- **afristays-gateway-requests.log** - Detailed incoming request logs with source IP, headers, and timing
- **afristays-gateway-responses.log** - Detailed outgoing response logs with status codes and response times
- **afristays-gateway-access.log** - Apache/Nginx style access logs for web server compatibility

### Error Logs
- **afristays-gateway-errors.log** - Error-level logs only for quick error identification

### Structured Logs
- **afristays-gateway-json.log** - JSON formatted logs for log aggregation systems (ELK, Splunk, etc.)

### System Logs
- **gc.log** - Java Garbage Collection logs for performance monitoring

## Log Format

### Request Logs
```
INCOMING_REQUEST | timestamp | requestId | clientIP | method | fullURL | userAgent | referer | contentType | authorization | headerCount
```

### Response Logs
```
OUTGOING_RESPONSE | timestamp | requestId | clientIP | method | fullURL | status | statusText | durationMs | contentType | contentLength | cacheControl | location | headerCount
```

### Access Logs (Apache Combined Format)
```
clientIP - - [timestamp] "METHOD URI PROTOCOL" status size "referer" "user-agent" response_time_ms
```

## Log Rotation

- **Size-based rotation**: Files rotate when they reach 100-500MB depending on the log type
- **Time-based rotation**: Daily rotation with date-based naming
- **Retention**: 30 days for most logs, 90 days for error logs
- **Total size cap**: 3-10GB depending on log type

## Monitoring and Analysis

### Key Metrics to Monitor
1. **Response Times**: Look for SLOW_RESPONSE entries (>5 seconds)
2. **Error Rates**: Monitor ERROR_RESPONSE entries
3. **Traffic Patterns**: Analyze request volumes by IP and endpoint
4. **Security**: Monitor for suspicious IP addresses or request patterns

### Useful Commands

#### View real-time requests
```bash
tail -f afristays-gateway-requests.log
```

#### Monitor errors
```bash
tail -f afristays-gateway-errors.log
```

#### Analyze top client IPs
```bash
grep "INCOMING_REQUEST" afristays-gateway-requests.log | awk -F'|' '{print $4}' | sort | uniq -c | sort -nr | head -10
```

#### Find slow requests (>5 seconds)
```bash
grep "SLOW_RESPONSE" afristays-gateway.log
```

#### Monitor specific endpoint
```bash
grep "/api/v1/auth" afristays-gateway-requests.log
```

#### Check response status distribution
```bash
grep "OUTGOING_RESPONSE" afristays-gateway-responses.log | awk -F'|' '{print $7}' | sort | uniq -c | sort -nr
```

## Log Levels

- **TRACE**: Very detailed debugging information
- **DEBUG**: Detailed debugging information
- **INFO**: General application flow
- **WARN**: Warning conditions (slow responses, etc.)
- **ERROR**: Error conditions that need attention

## Security Considerations

- Authorization headers are masked in logs (shown as "Bearer ***")
- Sensitive cookies are not logged
- Full request/response bodies are not logged by default
- IP addresses are logged for security monitoring

## Integration with Log Aggregation

The JSON log files can be easily ingested by:
- **ELK Stack** (Elasticsearch, Logstash, Kibana)
- **Splunk**
- **Fluentd**
- **Grafana Loki**

Example Logstash configuration:
```ruby
input {
  file {
    path => "/app/logs/afristays-gateway-json.log"
    codec => "json"
  }
}

filter {
  if [logger_name] == "REQUEST_LOGGER" {
    mutate { add_tag => ["request"] }
  }
  if [logger_name] == "RESPONSE_LOGGER" {
    mutate { add_tag => ["response"] }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "afristays-gateway-%{+YYYY.MM.dd}"
  }
}
```
